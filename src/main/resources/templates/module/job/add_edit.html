<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head th:include="system/include :: header"></head>

<body>
<form id="inputForm" class="form-horizontal" th:action="@{/system/job/save}" method="post">
    <input id="jobId" name="jobId" type="hidden" th:value="${timer?.jobId}"/>
    <input id="status" name="status" type="hidden" th:value="${timer?.status}"/>
    <table class="table table-bordered  table-condensed dataTables-example dataTable no-footer">
        <tbody>
        <tr>
            <td class="width20 active"><label class="pull-right"><font color="red">*</font> 任务名称:</label></td>
            <td><input type="text" name="jobName" id="jobName"  th:value="${timer?.jobName}" class="form-control"  placeholder="请输入任务名称" /></td>
        </tr>
        <tr>
            <td class="width20 active"><label class="pull-right"><font color="red">*</font> 任务组:</label></td>
            <td><input type="text" name="jobGroup" id="jobGroup"  th:value="${timer?.jobGroup}" class="form-control"  placeholder="请输入任务组名" /></td>
        </tr>
        <tr>
            <td class="width20 active"><label class="pull-right"><font color="red">*</font> 方法名:</label></td>
            <td><input type="text" name="methodName" id="methodName"  th:value="${timer?.methodName}" class="form-control"  placeholder="请输入方法名" /></td>
        </tr>        <tr>
            <td class="width20 active"><label class="pull-right">方法参数:</label></td>
            <td><input type="text" name="methodParams" id="methodParams"  th:value="${timer?.methodParams}" class="form-control"  placeholder="请输入方法参数" /></td>
        </tr>
        <tr>
            <td class="width20 active"><label class="pull-right"><font color="red">*</font> 时间规则:</label></td>
            <td><input type="tel" name="cronExpression" id="cronExpression"  th:value="${timer?.cronExpression}" class="form-control"  placeholder="这里输入时间规则" /></td>
        </tr>
        <tr>
            <td class="width20 active"><label class="pull-right">备注:</label></td>
            <td><input type="text" name="remark" id="remark" class="form-control" th:value="${timer?.remark}" placeholder="请输入备注"/></td>
        </tr>
        </tbody>
    </table>
    <table id="table_report" class="table table-striped table-bordered table-hover">
        <tr>
            <td style="width:75px;text-align: right;padding-top: 13px;" id="setFHTIME">设定:</td>
            <td style="text-align: right;">
                <select onchange="setTimegz(this.value, 'month')" class="form-control">
                    <option value="*">每</option>
                    <option value="1">一</option>
                    <option value="2">二</option>
                    <option value="3">三</option>
                    <option value="4">四</option>
                    <option value="5">五</option>
                    <option value="6">六</option>
                    <option value="7">七</option>
                    <option value="8">八</option>
                    <option value="9">九</option>
                    <option value="10">十</option>
                    <option value="11">十一</option>
                    <option value="12">十二</option>
                </select>
            </td>
            <td style="width:75px;text-align: left;padding-top: 13px;">月</td>
            <td style="text-align: right;">
                <select onchange="setTimegz(this.value, 'week')" id="weekId" class="form-control">
                    <option value="*">每</option>
                    <option value="MON">一</option>
                    <option value="TUES">二</option>
                    <option value="WED">三</option>
                    <option value="THUR">四</option>
                    <option value="FTI">五</option>
                    <option value="SAT">六</option>
                    <option value="SUN">七</option>
                </select>
            </td>
            <td style="width:75px;text-align: left;padding-top: 13px;">周</td>
            <td style="text-align: right;">
                <select onchange="setTimegz(this.value, 'day')" id="dayId" class="form-control">
                    <option value="*">每</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                </select>
            </td>
            <td style="width:75px;text-align: left;padding-top: 13px;">日</td>
            <td style="text-align: right;">
                <select onchange="setTimegz(this.value, 'hour')" class="form-control">
                    <option value="*">每</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                </select>
            </td>
            <td style="width:75px;text-align: left;padding-top: 13px;">时</td>
        </tr>
        <tr>
            <td colspan="10" class="center"><b>规则说明</b></td>
        </tr>
        <tr>
            <td colspan="10">
                <input type="text" class="form-control" name="timeExplain" id="timeExplain" th:value="${timer?.timeExplain}" placeholder="这里是规则说明" style="width:100%;" readonly="readonly"/>
            </td>
        </tr>
    </table>
    <div style="text-align: center"><button class="btn btn-primary" type="submit">保存内容</button> <button class="btn btn-danger" type="reset">取消</button></div>
</form>
<script type="text/javascript">

    var hour = "*";
    var day = "*";
    var week = "*";
    var month = "*";
    //设置时间规则
    function setTimegz(value, type) {
        if ('hour' == type) {
            hour = value;
        } else if ('day' == type) {
            day = value;
        } else if ('week' == type) {
            week = value;
        } else {
            month = value;
        }
        var strM = "";
        var strW = "";
        var strD = "";
        var strH = "";
        if ("*" == month) {
            strM = "每个月";
        } else {
            strM = "每年 " + month + " 月份";
        }
        if ("?" != week) {
            if ("*" == week) {
                strW = "每周";
                strD = "每天";
                $("#dayId").removeAttr("disabled");
                $("#dayId").css("background", "#FFFFFF");
            } else {
                $("#dayId").attr("disabled", "disabled");
                $("#dayId").css("background", "#F5F5F5");
                day = "?";
                strD = "";
                strW = "每个星期" + getWeek(week);
            }
        }
        if ("?" != day) {
            if ("*" == day) {
                strD = "每天";
                strW = "每周";
                $("#weekId").removeAttr("disabled");
                $("#weekId").css("background", "#FFFFFF");
            } else {
                $("#weekId").attr("disabled", "disabled");
                $("#weekId").css("background", "#F5F5F5");
                week = "?";
                strW = "";
                strD = day + "号";
            }
        }
        if ("*" == hour) {
            strH = "每小时";
        } else {
            strH = hour + "点时";
        }
        if ("*" == day && "*" == week) {
            day = "*";
            week = "?";
        }
        $("#cronExpression").val("0 0 " + hour + " " + day + " " + month + " " + week);
        $("#timeExplain").val(strM + "的 " + strW + " " + strD + " " + strH + "执行一次");
    }

    //获取星期汉字
    function getWeek(value) {
        var arrW = new Array("MON", "TUES", "WED", "THUR", "FTI", "SAT", "SUN");
        var arrH = new Array("一", "二", "三", "四", "五", "六", "日");
        for (var i = 0; i < arrW.length; i++) {
            if (value == arrW[i])
                return arrH[i];
        }
    }

    $("#inputForm").validate({
        rules: {
            jobName: "required",
            jobGroup: "required",
            methodName: "required",
            cronExpression: "required"
        },
        submitHandler: function (form) {
            $(form).ajaxSubmit({
                dataType: "json",
                success: function (data) {
                    if (data.code == "success") {
                        layer.msg(data.message, {icon: 1, time: 2000});
                        setTimeout(function () {
                            var index = top.layer.getFrameIndex(window.name);
                            var Iframe = top.getActiveIframe();
                            Iframe[0].contentWindow.toherDataTable.getDataTable().ajax.reload();
                            top.layer.close(index);
                        }, 2000);
                    } else {
                        layer.msg(data.message, {icon: 5, time: 4000});
                    }
                }
            });
        }
    });
</script>
</body>
</html>
